<!doctype html>
<head>
  <title>NRAO-530 Simulation</title>
  <meta charset="utf-8">
  <script src="bundle.js"></script>
  <script src="settings.js"></script>
  <link rel="stylesheet" href="main.css" type="text/css">
</head>
<body>
  <span class="settingsContainer"><a class="btn" href="/settings/">settings</a></span>
  <span class="data">
    <a class="btn" id="btn_play" href="#" onclick="toggleAnimation()">run</a>
    <a class="btn" href="#" onclick="s.increment()">step</a>
    <a class="btn" href="#" onclick="reset()">reset</a>
    <br><br>
    <label><input type="checkbox" onclick="s.toggleBlur()" checked> Convolution</label><br>
    <label><input type="checkbox" onclick="s.togglePAxis()" checked> Show precession axis</label><br>
  </span>
<script>
    let s;

    function reset() {
      if (s) {
        s.dispose();
        document.body.removeChild(s.domElement);
      }
      s = new sim(Settings.get());
      document.body.appendChild(s.domElement);
      s.setAspect(window.innerWidth, window.innerHeight);
    }

    window.addEventListener('resize', function () {
      s.setAspect(window.innerWidth, window.innerHeight);
    });

    let shouldAnimate = false;
    function toggleAnimation() {
      shouldAnimate = !shouldAnimate;
      document.getElementById('btn_play').innerHTML = shouldAnimate ? 'stop' : 'run';
    }

    function animate() {
      if (shouldAnimate) {
        s.increment();
      }
      requestAnimationFrame(animate);
    }
    reset();
    animate();
</script>
</body>
